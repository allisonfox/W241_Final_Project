---
title: "Power_Analysis"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
# Load packages
library(data.table)
```

Find an article that shows males and older individuals are more right leaning.
Vary the treatment effect size.
https://www.pewresearch.org/fact-tank/2020/04/01/americans-main-sources-for-political-news-vary-by-party-and-age/

```{r}
# create simulation function
percentages_to_sample <- seq(0.1, 2, by=0.1)

power_list <- c()

for (i in percentages_to_sample) {
  t_test_p_values <- rep(NA, 1000)
  t_test_p_values <- replicate(1000, lm(Y ~ is_male + is_female + is_old + is_facebook), 
                     data = d[, .SD[sample(x = .N, size = length(d$bid)*i, replace=TRUE)], 
                              by = treat_condition])
  power_list <- c(power_list, power) # create a list of lists (the internal list being for each coefficient)
  power_list
    tau_male
      p_value_1
      p_value_2
    tau_female
      p_value_1
      p_value_2
}

power_list

model <- lm(Y ~ is_male + is_female + is_old + is_facebook, data = d)
summary(model)
summary(model)$coefficients[,2] 
```

```{r}
# create a function to calculate power on the p-values
```

# Low Treatment Effect
```{r}
# create the science table 
d <- data.table(id = 1:126) 
d[ , ':='(
  y0 = rnorm(.N, mean = 0, sd = 1),
  tau_male = rnorm(.N, mean = 3, sd = 1), 
  tau_female = rnorm(.N, mean = -1, sd = 1), 
  tau_old = rnorm(.N, mean = 2, sd = 1),
  tau_facebook = rnorm(.N, mean = -1, sd = 1) 
)]

# run the experiment: assign
d[ , treat_condition := sample(c('na-young-facebook', 'na-old-facebook', 'male-young-facebook', 'male-old-facebook', 'female-young-facebook', 'female-old-facebook',
'na-young-youtube', 'na-old-youtube', 'male-young-youtube', 'male-old-youtube',
'female-young-youtube', 'female-old-youtube'), 
                               size = .N, replace = TRUE)]

# run the experiment: measure 
d <- as.data.table(d)
d[treat_condition == 'na-young-facebook', ':=' (Y = y0 + tau_facebook, is_male=0, is_female=0, is_old=0, is_facebook=1)]
d[treat_condition == 'na-old-facebook', ':=' (Y = y0 + tau_old + tau_facebook, is_male=0, is_female=0, is_old=1, is_facebook=1)]
d[treat_condition == 'male-young-facebook', ':=' (Y = y0 + tau_male + tau_facebook, is_male=1, is_female=0, is_old=0, is_facebook=1)]
d[treat_condition == 'male-old-facebook', ':=' (Y = y0 + tau_male + tau_old + tau_facebook, is_male=1, is_female=0, is_old=1, is_facebook=1)]
d[treat_condition == 'female-young-facebook', ':=' (Y = y0 + tau_female + tau_facebook, is_male=0, is_female=1, is_old=0, is_facebook=1)]
d[treat_condition == 'female-old-facebook', ':=' (Y = y0 + tau_female + tau_old + tau_facebook, is_male=0, is_female=1, is_old=1, is_facebook=1)]
d[treat_condition == 'na-young-youtube', ':=' (Y = y0, is_male=0, is_female=0, is_old=0, is_facebook=0)]
d[treat_condition == 'na-old-youtube', ':=' (Y = y0 + tau_old, is_male=0, is_female=0, is_old=1, is_facebook=0)]
d[treat_condition == 'male-young-youtube', ':=' (Y = y0 + tau_male, is_male=1, is_female=0, is_old=0, is_facebook=0)]
d[treat_condition == 'male-old-youtube', ':=' (Y = y0 + tau_male + tau_old, is_male=1, is_female=0, is_old=0, is_facebook=0)]
d[treat_condition == 'female-young-youtube', ':=' (Y = y0 + tau_female, is_male=0, is_female=1, is_old=0, is_facebook=0)]
d[treat_condition == 'female-old-youtube',   ':=' (Y = y0 + tau_female + tau_old, is_male=0, is_female=1, is_old=1, is_facebook=0)]


# for a variety of samples sizes (baseline is 126 - 10% increments of this from ranging from 10% to 200%), do the following:
# run 1000 simulations
# for each simulation:
  # run a regression
  # save the p-value
# calculate power across those 1000 simulations

# see how power changes as sample size changes - plot this
```

# Regular Treatment Effect
```{r}
# create the science table 
d <- data.table(id = 1:126) 
d[ , ':='(
  y0 = rnorm(.N, mean = 0, sd = 1),
  tau_male = rnorm(.N, mean = 5, sd = 1), 
  tau_female = rnorm(.N, mean = -3, sd = 1), 
  tau_old = rnorm(.N, mean = 4, sd = 1),
  tau_facebook = rnorm(.N, mean = -3, sd = 1) 
)]

# run the experiment: assign
d[ , treat_condition := sample(c('na-young-facebook', 'na-old-facebook', 'male-young-facebook', 'male-old-facebook', 'female-young-facebook', 'female-old-facebook',
'na-young-youtube', 'na-old-youtube', 'male-young-youtube', 'male-old-youtube',
'female-young-youtube', 'female-old-youtube'), 
                               size = .N, replace = TRUE)]

# run the experiment: measure 
d[treat_condition == 'na-young-facebook',     Y := y0 + tau_facebook]
d[treat_condition == 'na-old-facebook',       Y := y0 + tau_old + tau_facebook]
d[treat_condition == 'male-young-facebook',   Y := y0 + tau_male + tau_facebook]
d[treat_condition == 'male-old-facebook',     Y := y0 + tau_male + tau_old + tau_facebook]
d[treat_condition == 'female-young-facebook', Y := y0 + tau_female + tau_facebook]
d[treat_condition == 'female-old-facebook',   Y := y0 + tau_female + tau_old + tau_facebook]
d[treat_condition == 'na-young-youtube',     Y := y0]
d[treat_condition == 'na-old-youtube',       Y := y0 + tau_old]
d[treat_condition == 'male-young-youtube',   Y := y0 + tau_male]
d[treat_condition == 'male-old-youtube',     Y := y0 + tau_male + tau_old]
d[treat_condition == 'female-young-youtube', Y := y0 + tau_female]
d[treat_condition == 'female-old-youtube',   Y := y0 + tau_female + tau_old]
```

# Large Treatment Effect
```{r}
# create the science table 
d <- data.table(id = 1:126) 
d[ , ':='(
  y0 = rnorm(.N, mean = 0, sd = 1),
  tau_male = rnorm(.N, mean = 7, sd = 1), 
  tau_female = rnorm(.N, mean = -5, sd = 1), 
  tau_old = rnorm(.N, mean = 6, sd = 1),
  tau_facebook = rnorm(.N, mean = -5, sd = 1) 
)]

# run the experiment: assign
d[ , treat_condition := sample(c('na-young-facebook', 'na-old-facebook', 'male-young-facebook', 'male-old-facebook', 'female-young-facebook', 'female-old-facebook',
'na-young-youtube', 'na-old-youtube', 'male-young-youtube', 'male-old-youtube',
'female-young-youtube', 'female-old-youtube'), 
                               size = .N, replace = TRUE)]

# run the experiment: measure 
d[treat_condition == 'na-young-facebook',     Y := y0 + tau_facebook]
d[treat_condition == 'na-old-facebook',       Y := y0 + tau_old + tau_facebook]
d[treat_condition == 'male-young-facebook',   Y := y0 + tau_male + tau_facebook]
d[treat_condition == 'male-old-facebook',     Y := y0 + tau_male + tau_old + tau_facebook]
d[treat_condition == 'female-young-facebook', Y := y0 + tau_female + tau_facebook]
d[treat_condition == 'female-old-facebook',   Y := y0 + tau_female + tau_old + tau_facebook]
d[treat_condition == 'na-young-youtube',     Y := y0]
d[treat_condition == 'na-old-youtube',       Y := y0 + tau_old]
d[treat_condition == 'male-young-youtube',   Y := y0 + tau_male]
d[treat_condition == 'male-old-youtube',     Y := y0 + tau_male + tau_old]
d[treat_condition == 'female-young-youtube', Y := y0 + tau_female]
d[treat_condition == 'female-old-youtube',   Y := y0 + tau_female + tau_old]
```


```{r}
# plot the graphs 
# one plot for each variable
# three lines on each plot (low, medium, high)
```
